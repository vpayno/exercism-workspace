#!/bin/bash

declare -i retval=0

# git clone http://git.savannah.gnu.org/r/gawk.git
# cd gawk
# git checkout $(awk --version | awk '/^GNU Awk/ { print $3 }' | tr -d ',')
# cd ..
# git clone https://github.com/soimort/awkunit
# cd awkunit
# AWKSRCPATH=../gawk make
# cp -v awkunit.so ~/.local/gawk/lib/awkunit.so

# awkunit.so file needs to be in the lib directory
# awkunit.awk file needs to be in the current directory

export AWKLIBPATH="../.lib"

printf "AWKLIBPATH=%s\n\n" "${AWKLIBPATH}"
ls "${AWKLIBPATH}"/
printf "\n"

# shellcheck disable=SC2028
echo Running: gawk --file ./*_test.awk "&&" printf "\n%s\n" "Tests Passed!" "||" printf "\n%s\n" "Tests Failed!"
if time gawk --file ./*_test.awk; then
	printf "\n%s\n" "Tests Passed!"
else
	(( retval++ ))
	printf "\n%s\n" "Tests Failed!"
fi

exit "${retval}"
