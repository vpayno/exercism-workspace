#!/bin/bash

print_ruler() {
	printf "\n"
	printf "=%.0s" {1..79}
	printf "\n"
	printf "\n"
} # print_ruler()

declare -i retval=0

main() {
	deps=$(cargo tree | wc -l)
	((deps--))
	if [[ ${deps} -eq 0 ]]; then
		printf "No deps found, skipping cargo audit.\n"

		return "${retval}"
	fi

	printf "Running Rust Cargo Audit\n\n"

	printf "Running "
	rustc --version

	print_ruler

	echo Running: cargo clean
	time cargo clean

	print_ruler

	echo Runnin: cargo tree
	printf "\n"
	time cargo tree
	printf "\n"

	print_ruler

	# https://docs.rs/cargo-audit/latest/cargo_audit/

	echo Running: cargo audit "${@}"
	printf "\n"
	time cargo audit "${@}" || ((retval++))

	print_ruler

	echo Exit code: "${retval}"
	return "${retval}"
}

time main "${@}"
